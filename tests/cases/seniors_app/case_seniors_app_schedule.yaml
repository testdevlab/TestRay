# CXTB-10: Full Schedule display
TestVerifyFullScheduleDisplay:
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-fake-ui-for-media-stream
            - use-fake-device-for-media-stream
            - no-sandbox
            - disable-gpu
      App: desktop    
  Actions:
  # Set up past event on Care Platform.
    - Type: case
      Value: SetPastEventForSeniors
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.close_btn$
      Condition:
      - Value: 5
        Operation: visible
        Result: true
  # iPad steps started now.
  # Navigate to the Schedule page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.full_schedule_btn$
    - Type: get_timestamp
      Format: "%A %B %-d"
      Var: TODAY_DATE
  # Verify that the Full Schedule page loaded as expected.
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.schedule_date_label$
      Attribute: value
      ResultVar: TODAY_DATE_SCHEDULE
    - Type: assert
      Asserts:
        - Type: contain
          Var: TODAY_DATE_SCHEDULE
          Value: $AND_CLI_TODAY_DATE$
    # Click on the left arrow and verify that the date changes and the page updates to show the day prior.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.left_arrow_schedule$
    - Type: get_yesterday_date
      Format: "%A %B %-d"
      Var: YESTERDAY_DATE
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.schedule_date_label$
      Attribute: value
      ResultVar: YESTERDAY_DATE_SCHEDULE
    - Type: assert
      Asserts:
        - Type: contain
          Var: YESTERDAY_DATE_SCHEDULE
          Value: $AND_CLI_YESTERDAY_DATE$
      # Click on the right arrow twice and verify that the date changes and the page updates to show the day prior.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.right_arrow_schedule$
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.right_arrow_schedule$
    - Type: get_tomorrow_date
      Format: "%A %B %-d"
      Var: TOMORROW_DATE
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.schedule_date_label$
      Attribute: value
      ResultVar: TOMORROW_DATE_SCHEDULE
    - Type: assert
      Asserts:
        - Type: contain
          Var: TOMORROW_DATE_SCHEDULE
          Value: $AND_CLI_TOMORROW_DATE$
    # Click the button "Today" and veirfy that page refreshed, showing todayâ€™s date and schedule.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.today_btn$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.schedule_date_label$
      Attribute: value
      ResultVar: TODAY_DATE_SCHEDULE
    - Type: assert
      Asserts:
        - Type: contain
          Var: TODAY_DATE_SCHEDULE
          Value: $AND_CLI_TODAY_DATE$
    # Verify that any event that is over has moved to the bottom of the list.
    - Type: verify_event_went_to_bottom
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.events_elements$
      EventName: $AND_CLI_UNIQUE_EVENT_NAME$

# CXTB-12: Schedules Page Navigation
TestSchedulesPageNavigation:
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
  Roles:
    - Role: localiOS
      App: NeverAlone
  Actions:
  # In the Home page, click on the button "Full Schedule" and verify user is redirected to Schedules page.
    - Type: case
      Value: SchedulesPageNavigationHelper
  # Terminate the app.
    - Type: case
      Value: TerminateApp

# CXTB-39: Automatically Return to Full Schedule Page After Period of Inactivity
TestAutomaticReturnAfterInactivty:
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      Capabilities:
        newCommandTimeout: 310
      App: NeverAlone
    - Role: desktopChrome
      App: desktop 
  Actions:
  # Set up an appointment for the senior.
    - Type: case
      Value: SetScheduledCallForSeniors
  # In the Home page, click on the button "Full Schedule" and verify user is redirected to Schedules page.
    - Type: case
      Value: SchedulesPageNavigationHelper
  # Click an event in the listing.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.first_event$
  # Event details view should be displayed.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.appointment_header_modal$
  # Wait for 5 minutes without performing any actions.
    - Type: sleep
      Time: 300
  # Schedules page should be displayed.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.schedule_label$

# Only for physical devices.
# CXTB-16: Call Personal Care Partner Button on Full Schedule
TestCallPersonalCareButtonOnFullSchedule:
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop 
  Actions:
  # In the Home page, click on the button "Full Schedule" and verify user is redirected to Schedules page.
    - Type: case
      Value: SchedulesPageNavigationHelper
  # Click the "Call Personal Care Partner" button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.call_care_partner$
  # Device screen updates to show screen asking what kind of help you need:
  # Medical, Non-Medical and Cancel Call
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.medical_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.non_medical_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.cancel_call_button$
  # Click "Non-Medical" button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.non_medical_call_button$
  # Device screen updates showing you connecting, in the waiting room.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.waiting_room_label$
  # Care partner steps to take the call.
    - Type: case
      Value: AnswerCallAsCarePartner
  # Turn your camera on using the button along the bottom of the page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_button$
  # Thumbnail will appear in upper right corner of the video window, indicating your camera is on and giving a preview of what the Care Partner is seeing.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_window$
  # Click "End Call".
    - Type: click
      Strategy: xpath
      Id: $PAGE.seniors_app_call.end_call_button$
  # Fill in the post call survey with the Great option.
    - Type: case
      Value: SeniorGreatPostSurveyCallHelper
  # Care partner tear down
    - Type: case
      Value: PostCallSurveyCarePartner

# CXTB-87: Verify no prompts for cancelled appointments
TestNoPromptsForCancelledAppointments:
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop 
  Actions:
  # In the Home page, click on the button "Full Schedule" and verify user is redirected to Schedules page.
    - Type: case
      Value: SchedulesPageNavigationHelper
  # Set an appointment for the future.
    - Type: case
      Value: SetScheduledCallForSeniorsToStartIn11Minutes
  # Verify the appointment was registered in the schedule.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.event_based_on_name_element$
  # Care partner cancels the appointment
    - Type: case
      Value: DeleteFutureEventForSenior
  # Verify that there are no notifications related to the cancelation of the appointment.
    - Type: sleep
      Time: 10
    - Type: wait_not_visible
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.appointment_header_modal$
      Time: 10
  # Verify that the appointment is no longer schedule.
    - Type: sleep
      Time: 10
    - Type: wait_not_visible
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.event_based_on_name_element$
      Time: 10

# CXTB-18: Verify Future Non-Telehealth Event Window Access
TestFutureNonTelehealthEventWindowAccess:
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop 
  Actions:
  # In the Home page, click on the button "Full Schedule" and verify user is redirected to Schedules page.
    - Type: case
      Value: SchedulesPageNavigationHelper
  # Set an appointment for the future.
    - Type: case
      Value: SetScheduledCallForSeniorsToStartIn11Minutes
  # Verify the appointment was registered in the schedule.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.event_based_on_name_element$
  # Click the future event in the schedule listing.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.event_based_on_name_element$
  # Appointment event detail window opens showing the following information:
  # What, Date, Time, Where and Description.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.appointment_header_modal$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.what_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.date_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.time_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.where_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.description_label$
  # Click on the "Close" button in the upper right corner.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.close_btn$
    - Type: wait_not_visible
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.appointment_header_modal$
      Time: 10
  # User is redirected to the Schedules page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.schedule_label$