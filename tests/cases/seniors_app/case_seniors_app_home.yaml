# Physical Only
# CXTB-70: Verify Call Personal Care Partner Button on Page
TestSeniorAppCallPersonalCarePartnerOnHomePage:
  Vars:
    TIME: 5
    INTERFACE: en0
    VIDEO_IN: "1"
    TEST_FOLDER: $AND_CMD_pwd$/Reports/executions/$AND_CMD_date +%s$
  Environment: Settings
  Precases:
    - LoginNeverAloneHelper
    - SeniorCleanPrompts
    - CarePartnerCleanCallQueueAndHangedCalls
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      Capabilities:
        chromeOptions:
          args:
            - use-file-for-fake-audio-capture=$AND_CMD_pwd$/video_audio_samples/sample3.wav
            - use-file-for-fake-video-capture=$AND_CMD_pwd$/video_audio_samples/sample_640x360.mjpeg
      App: desktop
    - Role: command1
      App: command
  Actions:
    # Login to the Care Platform app with Care Partners account.
    - Type: case
      Value: CarePartnerLogin
    # Click on the Call Personal Care Partner button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.call_care_partner$
    # Verify that the screen updates to show screen asking what kind of heelp you need:
    # Medical 
    # Non-Medical
    # Cancel Call
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.medical_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.non_medical_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.cancel_call_button$
    # Click on the Cancel Call button and verify that Home page is displayed.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.cancel_call_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.call_care_partner$
    # Click on the Call Personal Care Partner button again.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.call_care_partner$
    # Click on the Non Medical call button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.non_medical_call_button$
    # Verify that screen redirects to the call waiting room.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.waiting_room_label$
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_button$
    ## Care partner steps to take the call.
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_home.first_call_of_queue$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_home.answer_call$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_btn$
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.video_mirror_care_partner$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.full_screen_call_btn$
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.verify_video_is_full_screen$
    - Type: click
      Strategy: xpath
      Id: $PAGE.seniors_app_call.mute_call_button$
    # Record the call.
    - Type: case
      Value: GetCallRecordings
    # Analyze the call.
    - Type: case
      Value: AnalyzeRecordings
    # Make video quality assertions
    - Type: case
      Value: VideoQualityAssertions
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.full_screen_call_btn$
    # Care partner leaves the call.
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.leave_call_btn$
    # Select the Bad option on the Post Survey screen.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.bad_answer_button$
    # Verify page updates to ask why you made your selection and presents you with a set of reasons, or gives you option to return to main survey page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.video_quality_not_good_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.could_not_hear_audio_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.problem_was_not_solved_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.issue_with_care_partner_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.call_was_not_answered_option$
    # Click on the back to select button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.back_to_select_button$
    # Select the Ok option.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.ok_answer_button$
    # Verify page updates to ask why you made your selection and presents you with a set of reasons, or gives you option to return to main survey page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.video_quality_not_good_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.could_not_hear_audio_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.problem_was_not_solved_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.issue_with_care_partner_option$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.call_was_not_answered_option$
    # Click on the back to select button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.back_to_select_button$
    # Select the Great option.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.great_answer_button$
    # Verify page updates and shows Thank You for you feedback page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.thank_you_label$
    # Do not click the "To Home" button on Thank you for your feedback screen.
    - Type: sleep
      Time: 8
    # Verify device is automatically returned to home page after a few seconds.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.call_care_partner$
    # End the call on care partner side - Teardown.
    # Fill the notes
    - Type: send_keys
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.subject_input$
      Value: Missed Call Subject Automation
    - Type: send_keys
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.providers_call_handling_page.details_textarea$
      Value: Missed Call Details Automation     
    - Type: wait_for_property
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.complete_session_btn$ 
      Property: disabled
      Value: "false"
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.complete_session_btn$             
    # Fill the Post-call Survey
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.non_medical_radiobtn$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.non_medical_radiobtn$             
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.issue_resolved_yes_radiobutton$          
    - Type: click
      Role: desktopChrome
      Strategy: id
      Id: $PAGE.care_platform_call_portal.category_select$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.medical_question_option$
    - Type: click
      Role: desktopChrome
      Strategy: id
      Id: $PAGE.care_platform_call_portal.subcategory_select$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.located_provider_option$
    - Type: click
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_call_portal.submit_and_exit_session_button$
    - Type: wait_for
      Role: desktopChrome
      Strategy: xpath
      Id: $PAGE.care_platform_notifications.call_completed_notification$

# Physical only
# CXTB-47: Verify in App Offline Behavior
TestSeniorAppVerifyInAppOfflineBehavior:
  Environment: Settings
  Precases:
    - SetScheduledCallForSeniors
    - LoginNeverAloneHelper
    - SeniorCleanPrompts
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop
  Actions:
    # Navigate to Notifications page.
    - Type: case
      Value: NotificationsPageNavigationHelper
    # Wait for notifications to load before the device goes offline.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.first_notification$
      Time: 30
    # Click on the Close button to go back to Home page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.close_btn$
    # Disconnect from wi-fi to get device offline while viewing the home page.
    - Type: toggle_wifi
      Role: localiOS
    # Verify there is a yellow message bar that indicates that the device is offline and to dial 911 in emergency.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.offline_yellow_bar$
      Time: 30
    # Verify that the call buttons has been replaced with a single gray inactive button saying:
    # "Personal Care Partner and Emergency Services are Offline"
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.offline_call_button$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.offline_call_button$
      Attribute: label
      ResultVar: OFFLINE_CALL_BUTTON_VALUE
      NoNewLine: true
    - Type: assert
      Asserts:
        - Type: eq
          Var: OFFLINE_CALL_BUTTON_VALUE
          Value: Personal Care Partner and Emergency Services are Offline
    # Verify that the emergency call button disappears.
    - Type: wait_not_visible
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.emergency_services_button$
      Time: 10
    # Click an event from the schedule listing.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.first_event$
    # Verify that a connection error message window appears indicating that the device is offline.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.connection_header_header_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.device_offline_label$
    # Close the message window.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.close_btn$  
    # Navigate to Schedules
    - Type: case
      Value: SchedulesPageNavigationHelper
    # Verify there is a yellow message bar that indicates that the device is offline and to dial 911 in emergency.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.offline_yellow_bar$
      Time: 30
    # Verify that the call buttons has been replaced with a single gray inactive button saying:
    # "Personal Care Partner & Emergency Services are Offline"
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.offline_call_button$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.offline_call_button$
      Attribute: label
      ResultVar: SCHEDULE_OFFLINE_CALL_BUTTON_VALUE
      NoNewLine: true
    - Type: assert
      Asserts:
        - Type: eq
          Var: SCHEDULE_OFFLINE_CALL_BUTTON_VALUE
          Value: Personal Care Partner & Emergency Services are Offline
    # Verify that the emergency call button disappears.
    - Type: wait_not_visible
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.emergency_services_button$
      Time: 10
    # Click an event from the schedule listing.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.first_event$
    # Verify that a connection error message window appears indicating that the device is offline.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.connection_header_header_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.device_offline_label$
    # Close the message window.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.close_btn$
    # Click on the Close button to go back to Home page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.close_btn$
    # Navigate to Notifications page.
    - Type: case
      Value: NotificationsPageNavigationHelper
    # Navigate to the All tab.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.all_tab$
    # Click a notification from the notifications listing.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.first_notification$
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.first_notification$
    # Verify that a connection error message window appears indicating that the device is offline.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.connection_header_header_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.device_offline_label$
    # Close the message window.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_connection_error_modal.close_btn$
    # Click on the Close button to go back to Home page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.close_btn$
  # Connect back the wi-fi to get device online.
    - Type: toggle_wifi
      Role: localiOS

# CXTB-38: Verify app automatically returns to Home page after inactivity period.
TestSeniorAutoReturnToHomePageAfterInactivityPeriod:
  Environment: Settings
  Precases:
    - SetScheduledCallForSeniors
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      Capabilities:
        newCommandTimeout: 310
      App: NeverAlone
    - Role: desktopChrome
      App: desktop
  Actions:
    # Navigate to Settings "My Details" page.
    - Type: case
      Value: SettingsPageNavigationHelper
    # Wait for 5 minutes and validate that Home page is displayed after waiting for 5 minutes.
    - Type: sleep
      Time: 300
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.full_schedule_btn$
    # Navigate to Notifications page.
    - Type: case
      Value: NotificationsPageNavigationHelper
    # Wait for 5 minutes and validate that Home page is displayed after waiting for 5 minutes.
    - Type: sleep
      Time: 300
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.full_schedule_btn$
    # Navigate to Notifications page again.
    - Type: case
      Value: NotificationsPageNavigationHelper
    # Click on a notification.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.first_notification$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.appointment_header_modal$
    # Wait for 5 minutes and validate that Home page is displayed after waiting for 5 minutes.
    - Type: sleep
      Time: 300
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.full_schedule_btn$
    # Click on an event on the home page listing.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.first_event$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.appointment_header_modal$
    # Wait for 5 minutes and validate that Home page is displayed after waiting for 5 minutes.
    - Type: sleep
      Time: 300
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.full_schedule_btn$

# CXTB-68: Verify Appointments appear as expected in Home page
TestSeniorAppointmentsAppearAsExpectedHomePage:
  Environment: Settings
  Vars:
    LOGOUT_OPTION: "Stay On Shift"
  Precases:
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop
  Actions:
    # Create event for the current day
    - Type: case
      Value: SetScheduledCallForSeniors
    # Calling Logout case
    - Type: case
      Value: CarePlatformLogout
    # Set up past event on Care Platform.
    - Type: case
      Value: SetPastEventForSeniors
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.close_btn$
      Condition:
      - Value: 5
        Operation: visible
        Result: true
    # Verify that only the current day's event are listed
    - Type: verify_all_events_match_todays_date
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.events_elements$
      SecondStrategy: xpath
      SecondId: $PAGE.seniors_app_home.date_value_appointment_modal$
    # Verify that any event that is over has moved to the bottom of the list.
    - Type: verify_event_went_to_bottom
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.events_elements$
      EventName: $AND_CLI_UNIQUE_EVENT_NAME$

# CXTB-83: Verify starting soon notification while in the notification window.
TestSeniorStartingSoonNotification:
  Environment: Settings
  Precases:
    - SetScheduledCallForSeniorsToStartIn7Minutes
    - SetScheduledCallForSeniorsToStartIn11Minutes
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      Capabilities:
        newCommandTimeout: 300
      App: NeverAlone
    - Role: desktopChrome
      App: desktop
  Actions:
    # Click an event from the schedule listing.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.first_event$
    # Wait for the first Starting Soon notification from the first meeting.
    - Type: sleep
      Time: 120
    # Verify that the Starting Soon notification has not appeared until user closes the events detail view.
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.appointment_header_modal$
      Attribute: label
      ResultVar: APPOINTMENT_HEADER_TEXT
    - Type: assert
      Asserts:
        - Type: ne
          Var: APPOINTMENT_HEADER_TEXT
          Value: Appointment Starting Soon
    # Click on the Close button to go back to Home page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.close_btn$
    # Verify that Starting Soon notification should show up.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.appointment_starting_soon_header_modal$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.appointment_starting_soon_header_modal$
      Attribute: label
      ResultVar: APPOINTMENT_HEADER_TEXT
    - Type: assert
      Asserts:
        - Type: eq
          Var: APPOINTMENT_HEADER_TEXT
          Value: Appointment Starting Soon
    # Click on the Close button to go back to Home page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.close_btn$
    # Add some sleep time to be closer to the 5 mins notification.
    - Type: sleep
      Time: 120
    # Open a notification to see the notification detail window.
    - Type: case
      Value: NotificationsPageNavigationHelper
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.first_notification$
    # Add some sleep time to be complete the 5 mins notification.
    - Type: sleep
      Time: 240
    # Verify that the Starting Soon notification has not appeared until user closes the notifications detail view.
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.appointment_header_modal$
      Attribute: label
      ResultVar: APPOINTMENT_HEADER_TEXT
    - Type: assert
      Asserts:
        - Type: ne
          Var: APPOINTMENT_HEADER_TEXT
          Value: Appointment Starting Soon
    # Click on the Close button to go back to Home page.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.close_btn$
    # Verify that Starting Soon notification should show up.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.appointment_starting_soon_header_modal$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_notifications.appointment_starting_soon_header_modal$
      Attribute: label
      ResultVar: APPOINTMENT_HEADER_TEXT
    - Type: assert
      Asserts:
        - Type: eq
          Var: APPOINTMENT_HEADER_TEXT
          Value: Appointment Starting Soon

# CXTB-83: Verify starting soon notification while in the notification window.
TestSeniorAlertAndStartingSoonVisuals:
  Environment: Settings
  Precases:
    - SetScheduledCallForSeniorsToStartIn7Minutes
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      Capabilities:
        newCommandTimeout: 150
      App: NeverAlone
    - Role: desktopChrome
      App: desktop
  Actions:
    # Wait for the Starting Soon modal and verify it appears on the screen indicating relative start time and the event details with a join button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.close_btn$
      Condition:
      - Value: 5
        Operation: visible
        Result: true
    - Type: sleep
      Time: 120
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.appointment_starting_soon_header_modal$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.appointment_starting_soon_header_modal$
      Attribute: label
      ResultVar: APPOINTMENT_HEADER_TEXT
    - Type: assert
      Asserts:
        - Type: eq
          Var: APPOINTMENT_HEADER_TEXT
          Value: Appointment Starting Soon
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.what_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.date_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.time_label$
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.seniors_app_appointment_modal.time_value$
      Attribute: label
      ResultVar: TIME_VALUE
    - Type: assert
      Asserts:
        - Type: contain
          Var: TIME_VALUE
          Value: $AND_CLI_FUTURE_START_6MINUTES_FOR_COMPARISON$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.where_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.description_label$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.join_button$
    # Click "Close" in the upper right corner.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.close_btn$
    - Type: wait_not_visible
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.close_btn$
      Time: 10
    # Verify user was redirected to Home page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.full_schedule_btn$
    # Verify event display is showing a message that says "In # min".
    - Type: get_text
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.event_based_on_name_element$
      Greps:
        - var: EVENT_STARTS_IN_X_MINS
          match: 'In \d min'
          NoRaise: false
    # Click the event in the listing.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.event_based_on_name_element$
    # Verify that a modal has appeared with a "Join" button.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.join_button$
    # Click "Close" in the upper right corner.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.close_btn$
    # Verify user was redirected to Home page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.full_schedule_btn$
    # Navigate to Schedules
    - Type: case
      Value: SchedulesPageNavigationHelper
    # Verify event display is showing a message that says "In # min".
    - Type: get_text
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.event_based_on_name_element$
      Greps:
        - var: EVENT_STARTS_IN_X_MINS
          match: 'In \d min'
          NoRaise: false
    # Click the event in the listing.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.event_based_on_name_element$
    # Verify that a modal has appeared with a "Join" button.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.join_button$
    # Click on th "Join" button before the appointment's start time.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.join_button$
    # Verify that "Waiting Room" label appears once user is connected to the Care Platform.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.waiting_room_label$
    # Complete the telehealth call with the provider, testing any controls you would like - volume, brightness and camera.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.volume_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.brightness_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_button$
    # Then click "End Call".
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.end_call_button$
    # Skip the survey.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.skip_survey_button$
    # Verify user was redirected to Home page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.full_schedule_btn$
    # Verify that any event that is over has moved to the bottom of the list.
    - Type: verify_event_went_to_bottom
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.events_elements$
      EventName: $AND_CLI_UNIQUE_EVENT_NAME$

# CXTB-50: Verify active appointment time window when not joined prior.
TestSeniorActiveAppointmentTimeWindowWhenNotJoinedPrior:
  Environment: Settings
  Precases:
    - SetScheduledCallForSeniorsToStartIn7Minutes
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      Capabilities:
        newCommandTimeout: 450
      App: NeverAlone
    - Role: desktopChrome
      App: desktop
  Actions:
    # Wait for the Starting Soon modal and verify it appears on the screen indicating relative start time and the event details with a join button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.close_btn$
      Condition:
      - Value: 5
        Operation: visible
        Result: true
    - Type: sleep
      Time: 420
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.appointment_header_modal$
    - Type: return_element_attribute
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.appointment_header_modal$
      Attribute: label
      ResultVar: APPOINTMENT_HEADER_TEXT
    - Type: assert
      Asserts:
        - Type: eq
          Var: APPOINTMENT_HEADER_TEXT
          Value: Appointment Started
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.close_btn$
    - Type: wait_not_visible
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.close_btn$
      Time: 10
    # Verify user was redirected to Home page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.full_schedule_btn$
    # See the event in the events listing in the Home page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.event_based_on_name_element$
    # Event display should show that there is a visual saying "Live".
    - Type: get_text
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.event_based_on_name_element$
      Greps:
        - var: LIVE_EVENT_TEXT
          match: "Live"
    - Type: assert
      Asserts:
        - Type: eq
          Var: LIVE_EVENT_TEXT
          Value: Live
    # Click the event.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.event_based_on_name_element$
    # Appointment window opens indicating that it’s Live and the event details with a "Join" button at the bottom.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.join_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.live_label$
    - Type: get_text
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.live_label$
      Greps:
        - var: LIVE_EVENT_LABEL
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: LIVE_EVENT_LABEL
          Value: Live
    # Click "Close" in upper right corner.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.close_btn$
    - Type: wait_not_visible
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.close_btn$
      Time: 10
    # Verify user was redirected to Home page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.full_schedule_btn$
    # Navigate to Schedules
    - Type: case
      Value: SchedulesPageNavigationHelper
    # Click the event in the listing with the "Live" message.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.event_based_on_name_element$
    # Appointment window opens indicating it’s live and the event details with a "Join" button at the bottom.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.join_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.live_label$
    - Type: get_text
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.live_label$
      Greps:
        - var: LIVE_EVENT_LABEL
          match: "(.*)"
    - Type: assert
      Asserts:
        - Type: eq
          Var: LIVE_EVENT_LABEL
          Value: Live
    # Click on th "Join" button.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_appointment_modal.join_button$
    # Verify that "Waiting Room" label appears once user is connected to the Care Platform.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.waiting_room_label$
    # Complete the telehealth call with the provider, testing any controls you would like - volume, brightness and camera.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.volume_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.brightness_button$
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.video_button$
    # Then click "End Call".
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_call.end_call_button$
    # Skip the survey.
    - Type: click
      Strategy: class_chain
      Id: $PAGE.seniors_app_post_call_survey.skip_survey_button$
    # Verify user was redirected to Home page.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.full_schedule_btn$
    # Verify that any event that is over has moved to the bottom of the list.
    - Type: verify_event_went_to_bottom
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.events_elements$
      EventName: $AND_CLI_UNIQUE_EVENT_NAME$

# CXTB-429:  Verify Emergency Services Button Visibility Is Controlled by EMS Enabled Flag
TestSeniorEmergencyServicesButtonVisibilityEMSEnabledFlag:
  Environment: Settings
  Vars:
    EMS_OPTION: 'true'
  Precases:
    - LoginNeverAloneHelper
  Aftercases:
    - TerminateApp
  Roles:
    - Role: localiOS
      App: NeverAlone
    - Role: desktopChrome
      App: desktop
  Actions:
    # Set the EMS Enabled flag to "Yes" with the Care Partner.
    - Type: case
      Value: CarePartnerLogin
    - Type: case
      Value: CarePartnerSetsEMSEnabledToXOption
    # When log in, device Emergency Services button is present on Home Screen.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.call_care_partner$
    # Navigate to Schedules
    - Type: case
      Value: SchedulesPageNavigationHelper
    # Verify that the Emergency Services button is present on Full Schedule Screen.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.emergency_services_button$
    # Set the EMS Enabled flag to "No" with the Care Partner.
    - Type: set_env_var
      Value: 'false'
      Var: EMS_OPTION
    - Type: case
      Value: CarePartnerSetsEMSEnabledToXOption
    # Restart the Never Alone app.
    - Type: case
      Value: TerminateApp
    - Type: case
      Value: LaunchApp
    - Type: case
      Value: LoginNeverAloneHelper
    # When log in, device Emergency Services button is not present on Home Screen.
    - Type: wait_not_visible
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.emergency_services_button$
    # Navigate to Schedules
    - Type: case
      Value: SchedulesPageNavigationHelper
    # Verify that the Emergency Services button is not present on Full Schedule Screen.
    - Type: wait_not_visible
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.emergency_services_button$
    # Set the EMS Enabled flag to "Yes" with the Care Partner.
    - Type: set_env_var
      Value: 'true'
      Var: EMS_OPTION
    - Type: case
      Value: CarePartnerSetsEMSEnabledToXOption
    # Restart the Never Alone app.
    - Type: case
      Value: TerminateApp
    - Type: case
      Value: LaunchApp
    - Type: case
      Value: LoginNeverAloneHelper
    # When log in, device Emergency Services button is present on Home Screen.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_home.emergency_services_button$
    # Navigate to Schedules
    - Type: case
      Value: SchedulesPageNavigationHelper
    # Verify that the Emergency Services button is present on Full Schedule Screen.
    - Type: wait_for
      Strategy: class_chain
      Id: $PAGE.seniors_app_schedule.emergency_services_button$