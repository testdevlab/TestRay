#CXTB-214: Validating Home elements
TestHomePage:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform.page_title$
      Condition:
      - Value: 2
        Operation: visible
        Result: true
  #Checking Home page and navigation
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform.page_title$
      Greps:
        - var: HOME_TITLE
          match: "Call Queue"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: eq
          Var: HOME_TITLE
          Value: "Call Queue"
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform.navigation_participant$
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform.page_title$
      Greps:
        - var: HOME_TITLE
          match: "Participants"
      Asserts:
        - Type: eq
          Var: HOME_TITLE
          Value: "Participants"
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform.navigation_followup$
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform.page_title$
      Greps:
        - var: HOME_TITLE
          match: "Follow-up*"
      Asserts:
        - Type: eq
          Var: HOME_TITLE
          Value: "Follow-up Tickets"
  #Checking Header elements
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.app_logo$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.app_time$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.user_toggle_input$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.headset_icon$
  #Checking options in the user drop-down
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
  #Status
      Id: $PAGE.care_platform_header.status_menu_header$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_available_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_away_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_insession_button$
    - Type: wait_for
      Strategy: xpath
  #Other options
      Id: $PAGE.care_platform_header.account_menu_header$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.help_menu_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.myaccount_menu_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.logout_menu_button$

#CXTB-223: Validating changes of status (Not in Call)
TestStatusDropdown_NotInCall:
  Environment: Settings 
  Precases:
    - CarePartnerCleanCallQueueAndHangedCalls
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform.page_title$
      Condition:
      - Value: 2
        Operation: visible
        Result: true
  #Status
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_menu_header$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_available_button$
  #Changing status to away
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_away_button$
  #Navigating to participants page
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform.navigation_participant$
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform.page_title$
      Greps:
        - var: HOME_TITLE
          match: "Participants"
      Asserts:
        - Type: eq
          Var: HOME_TITLE
          Value: "Participants"
  #Checking indicator is set to Away status
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: STATUS_VAR
          attr: class
          condition: nempty
          match: "(.*)has-status(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: STATUS_VAR
          Value: "is-empty"
  #Trying to change status to In Session (shouldn't let you do it manually)
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_insession_button$
    - Type: click_js
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_insession_button$
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform.navigation_followup$
  #Verifying the status indicator didn't change to In Session
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: STATUS_VAR
          attr: class
          condition: nempty
          match: "(.*)has-status(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: STATUS_VAR
          Value: "is-empty"
  #Changing status back to available
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_menu_header$
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_available_button$
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform.navigation_followup$
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform.page_title$
      Greps:
        - var: HOME_TITLE
          match: "Follow-up*"
      Asserts:
        - Type: eq
          Var: HOME_TITLE
          Value: "Follow-up Tickets"
  #Checking the status indicator correspond to Available
    - Type: get_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.status_indicator$
      Greps:
        - var: STATUS_VAR
          attr: class
          condition: nempty
          match: "(.*)has-status(.*)"
    - Type: assert
      Asserts:
        - Type: contain
          Var: STATUS_VAR
          Value: "is-green"

#CXTB-227 Account - Update info
TestUpdateInfoAccount:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLoginSecondaryUser
    - Type: case
      Value: CarePlatformUpdateInfo

#CXTB-237 Account - Help
TestAccountHelp:
  Environment: Settings 
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  #Going to My Account
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.user_dropdown_button$
  #Going to Help
    - Type: click
      Strategy: xpath
      Id : $PAGE.care_platform_header.help_menu_button$
  #Verify the Help page is visible
    - Type: switch_window
      Value: 1
      CheckTime: 10
    - Type: get_url
      Greps:
        - var: HELP_PAGE_URL
          match: "(.*)care_partner_user_manual(.*).pdf"
    - Type: assert
      Role: desktopChrome
      Asserts:
        - Type: contain
          Var: HELP_PAGE_URL
          Value: care_partner_user_manual
        - Type: contain
          Var: HELP_PAGE_URL
          Value: .pdf

#CXTB-236 Account - Update Password
TestUpdatePassword:
  Environment: Settings 
  Vars:
    LOGOUT_OPTION: "Stay On Shift"
    ENV_PASS_STORE: $AND_CLI_carepartner_user1_pwd$
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  #Calling Login case
    - Type: case
      Value: CarePartnerLogin
  #Calling helper to update password
    - Type: case
      Value: CarePlatformUpdatePassword

#CXTB-268 Log Out - Manually of Portal and Go Off Shift
TestLogoutGoOffShift:
  Environment: Settings 
  Vars:
    LOGOUT_OPTION: "Go Off Shift"
    CARE_PARTNER_USER1_FULLNAME: $AND_CLI_carepartner_user1_name$ $AND_CLI_carepartner_user1_lastname$
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  # Calling Login case.
    - Type: case
      Value: CarePartnerLogin
  # Clicking the name.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.user_dropdown_button$
  # Click on the logout button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.logout_menu_button$
  # Click on the cancel button.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_logout_modal.cancel_logout_button$
  # Calling Logout case.
    - Type: case
      Value: CarePlatformLogout
  # NOTE: Step 7 was skipped because it involved verifying text messages,
  # This step needed to call from SNF and then validate that care partner did not receive text notification.
  # Continued on Step 8.
  # Log in with the second user.
    - Type: case
      Value: CarePartnerLoginSecondaryUser
  # Click on the users dropdown.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.headset_dropdown_button$
  # Verify that the first user has gone off shift.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.offline_carepartner1_element$
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform_header.offline_carepartner1_element$
      Greps:
        - var: CARE_PARTNER_ELEMENT
          match: "(.*)"
    - Type: assert
      Asserts: 
      - Type: n_contain
        Var: CARE_PARTNER_ELEMENT
        Value: "Available"
    - Type: assert
      Asserts: 
      - Type: n_contain
        Var: CARE_PARTNER_ELEMENT
        Value: "Idle"
  # Log out of the second user too.
    - Type: case
      Value: CarePlatformLogout

#CXTB-234 Log Out - Manually of Portal and Stay On Shift
TestLogoutStayOnShift:
  Environment: Settings 
  Vars:
    LOGOUT_OPTION: "Stay On Shift"
    CARE_PARTNER_USER1_FULLNAME: $AND_CLI_carepartner_user1_name$ $AND_CLI_carepartner_user1_lastname$
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  # Calling Login case.
    - Type: case
      Value: CarePartnerLogin
  # Calling Logout case.
    - Type: case
      Value: CarePlatformLogout
  # NOTE: Step 4 was skipped because it involved verifying text messages,
  # This step needed to call from SNF and then validate that care partner did receive text notification.
  # Continued on Step 5.
  # Log in with the second user.
    - Type: case
      Value: CarePartnerLoginSecondaryUser
  # Click on the users dropdown.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.headset_dropdown_button$
  # Verify that the first user has stayed on shift.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.onshift_carepartner1_element$
      
#CXTB-92: Verify Access and Review Team Member's Availability
TestAccessAndReviewTeamMembersAvailability:
  Environment: Settings
  Vars:
    CARE_PARTNER_USER1_FULLNAME: $AND_CLI_carepartner_user1_name$ $AND_CLI_carepartner_user1_lastname$
  Roles:
    - Role: desktopChrome
      App: "desktop"
  Actions:
  # Calling Login case.
    - Type: case
      Value: CarePartnerLogin
  # Click on the users dropdown.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.headset_dropdown_button$
  # Care Partner list appears from right side of screen.
    - Type: wait_for
      Strategy: xpath
      Id: $PAGE.care_platform_header.users_dropdown_list$
    - Type: sleep
      Time: 5
  # Verify that the list shows care partner users and current statuses.
    - Type: get_text
      Strategy: xpath
      Id : $PAGE.care_platform_header.users_dropdown_list$
      Greps:
      - var: USERS_LIST_TEXT
        match: '[\s\S]*' # using single quotes due to YAML issues with regex and double quotes.
    - Type: assert
      Asserts: 
      - Type: contain
        Var: USERS_LIST_TEXT
        Value: "ON SHIFT"
    - Type: assert
      Asserts: 
      - Type: contain
        Var: USERS_LIST_TEXT
        Value: "OFF SHIFT"
    - Type: assert
      Role: desktopChrome
      Asserts:
      - Type: contain
        Var: USERS_LIST_TEXT
        Value: $AND_CLI_CARE_PARTNER_USER1_FULLNAME$
  # Click on the headset icon again.
    - Type: click
      Strategy: xpath
      Id: $PAGE.care_platform_header.headset_dropdown_button$
  # Verify that the list disappears.
    - Type: return_element_attribute
      Strategy: xpath
      Id: $PAGE.care_platform_header.users_dropdown_list$
      Attribute: className
      ResultVar: IS_LIST_OPEN
    - Type: assert
      Asserts:
        - Type: n_contain
          Var: IS_LIST_OPEN
          Value: users-dropdown-open